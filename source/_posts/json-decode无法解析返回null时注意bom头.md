---
title: json_decode无法解析返回null时注意bom头
tags:
  - PHP
  - 踩坑
id: '193'
categories:
  - - PHP
  - - 敲代码
date: 2018-07-08 12:50:36
---

去某网站获取一点统计数据，查看其请求方式发现有接口可以直接调用，浏览器打开通过插件直接解析出json了，非常高兴，这样在爬取数据的时候就简单多了。 说干就干，直接PHP的`file_get_contents`函数调用接口，返回正常，都没有什么安全检查的。 看了下json数据，层次也很简单，于是json\_decode直接解析出来做下分析即可。结果一调试了，报了个错，居然解析不了。 首先想到的是里边有特殊字符，于是用`file_put_contents`先把内容写到本地，用编辑器打开，精简json数据，再次尝试，发现还是不行。 最后精简到一段很简单的数据：

```json
{
    "aaa": 0,
    "bbb": 2252,
    "ccc": 12141,
    "data": []
}
```

这么简单的数据了，也不会有什么特殊字符了，可却就是解析不了，`json_last_error()`返回的是4也就是语法错误。把这段json复制到在线json解析能正常解析，直接在代码中用变量赋值也是能正常解析的。这样基本可以确定是这个文件有什么特殊的地方了。看了下编码格式是utf8没问题的，第一时间其实没有想到bom头的问题，网上一搜发现有bom这个坑，一试果然可行。

```php
$BOM = chr(239).chr(187).chr(191); 
$data=str_replace($BOM,'',$data);
```

查了下发现原来是php没有对bom头做处理，作为世界上最好的语言的PHP（手动滑稽）居然没有处理，一点都不符合最好的语言的风格啊！后边遇到这种看起诡异的问题记得留个心。 在创建文件的时候还是要注意不要使用带bom头的，以免带来一些奇奇怪怪的问题，平常没有遇到这样的问题，大部分是因为编辑器/IDE帮我处理了，默认使用的不带bom头的。但一旦遇到这样的问题，比如我调用的这个接口返回的json带bom头，也要思维灵活，多使用搜索引擎从多个维度搜索，遇到过一次，下次在遇到就能很快定位了，这就是经验的积累。