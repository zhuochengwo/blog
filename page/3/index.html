<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zhuochengwo.github.io","root":"/blog/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="生活的点点滴滴">
<meta property="og:type" content="website">
<meta property="og:title" content="程枫的个人博客">
<meta property="og:url" content="https://zhuochengwo.github.io/blog/page/3/index.html">
<meta property="og:site_name" content="程枫的个人博客">
<meta property="og:description" content="生活的点点滴滴">
<meta property="og:locale">
<meta property="article:author" content="Chengfeng">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://zhuochengwo.github.io/blog/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-Hans'
  };
</script>

  <title>程枫的个人博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">程枫的个人博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://zhuochengwo.github.io/blog/2018/07/11/ubuntu%E6%90%AD%E5%BB%BAnginxflaskgunicorn%E7%9A%84python-web%E7%8E%AF%E5%A2%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Chengfeng">
      <meta itemprop="description" content="生活的点点滴滴">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程枫的个人博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2018/07/11/ubuntu%E6%90%AD%E5%BB%BAnginxflaskgunicorn%E7%9A%84python-web%E7%8E%AF%E5%A2%83/" class="post-title-link" itemprop="url">Ubuntu搭建nginx+flask+gunicorn的Python web环境</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-07-11 11:32:54" itemprop="dateCreated datePublished" datetime="2018-07-11T11:32:54+08:00">2018-07-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-15 13:45:28" itemprop="dateModified" datetime="2020-12-15T13:45:28+08:00">2020-12-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B2%E4%BB%A3%E7%A0%81/" itemprop="url" rel="index"><span itemprop="name">敲代码</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近开始接触Python的web开发，选用了flask框架，这里记录下python web环境的搭建。 现在大部分web语言都有提供自带的web server功能用于开发调试，在开发阶段，我们可以通过flask run启用一个简单的web server，但这样的web server性能及稳定性欠佳，不建议用于生产环境。 我们先通过</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">virtualenv -p /usr/bin/python3 --no-site-packages venv</span><br></pre></td></tr></table></figure>

<p>创建一个虚拟环境，如果没有安装virtualenv请先安装，这里不再介绍virtualenv的安装。通过git pull或者其它方式将开发好的项目代码拉取过来，进入virtual环境并安装项目依赖，如果之前有将依赖导出到requirements.txt则可以非常快捷简单的安装了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> venv/bin/activate</span><br><span class="line"></span><br><span class="line">pip install -r requirements.txt</span><br><span class="line"><span class="comment">#或者直接安装flask和gunicorn</span></span><br><span class="line">pip install flask</span><br><span class="line">pip install gunicorn</span><br></pre></td></tr></table></figure>

<p>这里以一个最简单的hello world为例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_world</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello, World!&#x27;</span></span><br></pre></td></tr></table></figure>

<p>运行gunicorn</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gunicorn --workers=2 hello:app -b 127.0.0.1:9000 -D</span><br></pre></td></tr></table></figure>

<p>关于gunicorn这里不做过多展开，只介绍几个常用参数，具体详细介绍可google。</p>
<ul>
<li>  <strong>--workers</strong>   worker进程数</li>
<li>  <strong>hello:app</strong>   模块名：变量名</li>
<li>  <strong>-b</strong>  绑定ip及端口，如果需要外网访问ip请使用0.0.0.0，因为我们后边会用到nginx做反向代理，这里就绑定127.0.0.1</li>
<li>  <strong>-D</strong> 守护进程</li>
</ul>
<p>启动gunicorn后就可以通过<a target="_blank" rel="noopener" href="http://127.0.0.1:9000/">http://127.0.0.1:9000</a> 看到输出的hello world了。 如果我们有修改代码，需要重启gunicorn才能生效，可以使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -HUP 进程号</span><br></pre></td></tr></table></figure>

<p>重启，此处的进程号为master进程的pid。 接下来配置nginx。如果没有安装nginx可以通过下边命令安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nginx</span><br></pre></td></tr></table></figure>

<p>在/etc/nginx/site-enable下创建hello.flask.com文件，写入如下内容</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span> hello.flask.com;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">                <span class="attribute">proxy_pass</span> http://127.0.0.1:9000;</span><br><span class="line">                <span class="attribute">proxy_redirect</span>     <span class="literal">off</span>;</span><br><span class="line">                <span class="attribute">proxy_set_header</span>   Host                 $http_host;</span><br><span class="line">                <span class="attribute">proxy_set_header</span>   X-Real-IP            $remote_addr;</span><br><span class="line">                <span class="attribute">proxy_set_header</span>   X-Forwarded-For      $proxy_add_x_forwarded_for;</span><br><span class="line">                <span class="attribute">proxy_set_header</span>   X-Forwarded-Proto    $scheme;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过nginx -t测试配置是否正确，以免重启服务影响已有站点。测试通过重新载入配置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t</span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br><span class="line">$ sudo service nginx reload</span><br></pre></td></tr></table></figure>

<p>配置/etc/hosts，写入</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span> hello.flask.<span class="keyword">com</span></span><br></pre></td></tr></table></figure>

<p>访问<a target="_blank" rel="noopener" href="http://hello.flask.com能看到正常输出hello/">http://hello.flask.com能看到正常输出hello</a> world，至此flask+gunicorn部署成功。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://zhuochengwo.github.io/blog/2018/07/08/json-decode%E6%97%A0%E6%B3%95%E8%A7%A3%E6%9E%90%E8%BF%94%E5%9B%9Enull%E6%97%B6%E6%B3%A8%E6%84%8Fbom%E5%A4%B4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Chengfeng">
      <meta itemprop="description" content="生活的点点滴滴">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程枫的个人博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2018/07/08/json-decode%E6%97%A0%E6%B3%95%E8%A7%A3%E6%9E%90%E8%BF%94%E5%9B%9Enull%E6%97%B6%E6%B3%A8%E6%84%8Fbom%E5%A4%B4/" class="post-title-link" itemprop="url">json_decode无法解析返回null时注意bom头</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-07-08 12:50:36" itemprop="dateCreated datePublished" datetime="2018-07-08T12:50:36+08:00">2018-07-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-15 13:45:28" itemprop="dateModified" datetime="2020-12-15T13:45:28+08:00">2020-12-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B2%E4%BB%A3%E7%A0%81/" itemprop="url" rel="index"><span itemprop="name">敲代码</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/PHP/" itemprop="url" rel="index"><span itemprop="name">PHP</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>去某网站获取一点统计数据，查看其请求方式发现有接口可以直接调用，浏览器打开通过插件直接解析出json了，非常高兴，这样在爬取数据的时候就简单多了。 说干就干，直接PHP的<code>file_get_contents</code>函数调用接口，返回正常，都没有什么安全检查的。 看了下json数据，层次也很简单，于是json_decode直接解析出来做下分析即可。结果一调试了，报了个错，居然解析不了。 首先想到的是里边有特殊字符，于是用<code>file_put_contents</code>先把内容写到本地，用编辑器打开，精简json数据，再次尝试，发现还是不行。 最后精简到一段很简单的数据：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;aaa&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;bbb&quot;</span>: <span class="number">2252</span>,</span><br><span class="line">    <span class="attr">&quot;ccc&quot;</span>: <span class="number">12141</span>,</span><br><span class="line">    <span class="attr">&quot;data&quot;</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这么简单的数据了，也不会有什么特殊字符了，可却就是解析不了，<code>json_last_error()</code>返回的是4也就是语法错误。把这段json复制到在线json解析能正常解析，直接在代码中用变量赋值也是能正常解析的。这样基本可以确定是这个文件有什么特殊的地方了。看了下编码格式是utf8没问题的，第一时间其实没有想到bom头的问题，网上一搜发现有bom这个坑，一试果然可行。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$BOM</span> = chr(<span class="number">239</span>).chr(<span class="number">187</span>).chr(<span class="number">191</span>); </span><br><span class="line"><span class="variable">$data</span>=str_replace(<span class="variable">$BOM</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$data</span>);</span><br></pre></td></tr></table></figure>

<p>查了下发现原来是php没有对bom头做处理，作为世界上最好的语言的PHP（手动滑稽）居然没有处理，一点都不符合最好的语言的风格啊！后边遇到这种看起诡异的问题记得留个心。 在创建文件的时候还是要注意不要使用带bom头的，以免带来一些奇奇怪怪的问题，平常没有遇到这样的问题，大部分是因为编辑器/IDE帮我处理了，默认使用的不带bom头的。但一旦遇到这样的问题，比如我调用的这个接口返回的json带bom头，也要思维灵活，多使用搜索引擎从多个维度搜索，遇到过一次，下次在遇到就能很快定位了，这就是经验的积累。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://zhuochengwo.github.io/blog/2018/06/21/%E7%BC%A9%E5%87%8F%E8%A7%86%E9%A2%91%E5%B9%BF%E5%91%8A%E6%97%B6%E9%97%B4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Chengfeng">
      <meta itemprop="description" content="生活的点点滴滴">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程枫的个人博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2018/06/21/%E7%BC%A9%E5%87%8F%E8%A7%86%E9%A2%91%E5%B9%BF%E5%91%8A%E6%97%B6%E9%97%B4/" class="post-title-link" itemprop="url">缩减视频广告时间</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-06-21 20:21:36" itemprop="dateCreated datePublished" datetime="2018-06-21T20:21:36+08:00">2018-06-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-15 15:10:56" itemprop="dateModified" datetime="2020-12-15T15:10:56+08:00">2020-12-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E7%94%9F%E6%B4%BB/" itemprop="url" rel="index"><span itemprop="name">生活</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E5%88%86%E4%BA%AB%E5%8F%91%E7%8E%B0/" itemprop="url" rel="index"><span itemprop="name">分享发现</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E5%B0%8F%E6%8A%80%E5%B7%A7/" itemprop="url" rel="index"><span itemprop="name">小技巧</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>看视频总是难免碰到各种各样的广告，国内视频更是夸张到上百秒的广告，而且还不可跳过，使用广告拦截工具也有部分风险导致视频无法播放，而且确实也会影响视频网站的收入导致恶性循环。</p>
<p>如果你不想开通会员，也不想通过广告拦截插件屏蔽广告，又不愿忍受太长时间的广告时间，本文或许对你有一定的帮助。 </p>
<p>一般来说，几秒到十几秒的视频广告对用户来说还是可以接受的。我们要做的就是将广告缩减到我们能接受的程度。既不影响我们的观影体验，视频站的广告也成功播放，两全其美。 现在大部分的视频站都支持使用H5播放器，我们要做的就是利用H5播放器提供的加速播放功能来快速播放广告。但并不是所有的H5播放器都提供加速功能，而且，广告阶段肯定是不会提供加速支持的，这时，我们就需要通过浏览器插件来实现了。 </p>
<p>我个人日常使用的Chrome，使用的插件是<a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/video-speed-controller/nffaoalbilbmmfgbnbgppjihopabppdk?hl=en-US">Video Speed Controller</a> 通过这个插件，可以对所有H5播放器实现调速播放功能。原则上任何浏览器，任何提供调速功能的软件/插件都可以实现。 这是软件设置界面及我的个人设置 <img src="https://blog-1252719385.cos.ap-guangzhou.myqcloud.com/images/video_speed_controller_setting.png" alt="插件设置"> 这里要注意的主要是快捷键的设置，我保留使用默认快捷键，但将个人偏好速度（preferred speed）设置成了10倍速，这样在广告阶段可以通过快捷键G快速切换到10倍速，广告播放完毕后再通过快捷键R重置回正常速度。 </p>
<p>回到视频站，这里以优酷为例，播放时设置选择H5播放器，在播放广告的时候我们通过插件加速播放，将原本几十秒的广告快速播放，待进入正片后还原播放速度即可。 下边是我的操作演示，注意观察左上角的播放速度及右上角的广告剩余时间 <img src="https://blog-1252719385.cos.ap-guangzhou.myqcloud.com/images/operation.gif"> 可以看到，最开始的广告使用正常速度播放，几秒后通过插件快捷键G切换到10倍速（左上角速度提示），这时候可以看到广告剩余时间飞快跳动，广告最后几秒通过快捷键R切换到正常播放速度，随后在广告播放完毕正常进入正片。 </p>
<p>至此我们实现了简单的广告缩减，几十秒的广告在几秒钟看完，感觉我们的生命又续上了几秒。 最后，请低调使用。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://zhuochengwo.github.io/blog/2018/06/10/%E7%AE%80%E5%8D%95%E5%BF%AB%E9%80%9F%E7%94%A8%E4%B8%8Ahttps/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Chengfeng">
      <meta itemprop="description" content="生活的点点滴滴">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程枫的个人博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2018/06/10/%E7%AE%80%E5%8D%95%E5%BF%AB%E9%80%9F%E7%94%A8%E4%B8%8Ahttps/" class="post-title-link" itemprop="url">简单快速用上https</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-06-10 15:41:09" itemprop="dateCreated datePublished" datetime="2018-06-10T15:41:09+08:00">2018-06-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-15 13:45:28" itemprop="dateModified" datetime="2020-12-15T13:45:28+08:00">2020-12-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B2%E4%BB%A3%E7%A0%81/" itemprop="url" rel="index"><span itemprop="name">敲代码</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/Ubuntu/" itemprop="url" rel="index"><span itemprop="name">Ubuntu</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>相信不少人在浏览网页的时候都曾有过被运营商劫持加上广告的经历，更有甚者账号被盗，造成财产损失的情况。 普通人去购买https证书确实有点划不来，本篇文章主要介绍如何免费的使用https加固我们的站点。 我们要使用的就是大名鼎鼎的<a target="_blank" rel="noopener" href="https://letsencrypt.org/">Let’s Encrypt</a> ，<a target="_blank" rel="noopener" href="https://letsencrypt.org/">Let’s Encrypt</a> 是一个免费、开放，自动化的证书颁发机构，由 ISRG（Internet Security Research Group）运作。其官方推荐的自动化工具是<a target="_blank" rel="noopener" href="https://certbot.eff.org/">Certbot</a> 也就是我要介绍的工具。 certbot使用非常简单，进入其官网后，选择web-server程序，以及系统版本，就会安装提示，下边以ubuntu-nginx作为演示： <img src="https://blog-1252719385.cos.ap-guangzhou.myqcloud.com/images/20180610150801.png" alt="certbot选择界面">  在下方可以看到安装提示 <img src="https://blog-1252719385.cos.ap-guangzhou.myqcloud.com/images/20180610151442.png" alt="certbot安装提示"> 根据安装提示很容易就可以安装并使用certbot了 <strong>安装：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install software-properties-common</span><br><span class="line">sudo add-apt-repository ppa:certbot/certbot</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install python-certbot-nginx</span><br></pre></td></tr></table></figure>

<p><strong>使用：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --nginx</span><br></pre></td></tr></table></figure>

<p>后边就根据提示选择对应的域名操作即可，这里我已本站点为演示：</p>
<ol>
<li> 在列出的nginx域名列表中选择站点序号。选择后certbot会验证域名，并自动保存生产的证书信息</li>
<li> 选择是否重定向http到https。certbot会询问是否需要重定向</li>
<li> 看到”Congratulations! Your certificate and chain have been saved at:”表示证书安装成功</li>
<li> 重启nginx即可</li>
</ol>
<p>下边是我的操作记录，可供参考：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">$ sudo certbot --nginx</span><br><span class="line">Saving debug <span class="built_in">log</span> to /var/<span class="built_in">log</span>/letsencrypt/letsencrypt.log</span><br><span class="line">Plugins selected: Authenticator nginx, Installer nginx</span><br><span class="line"></span><br><span class="line">Which names would you like to activate HTTPS <span class="keyword">for</span>?</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">1: chengfeng.site</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">Select the appropriate numbers separated by commas and/or spaces, or leave input</span><br><span class="line">blank to select all options shown (Enter <span class="string">&#x27;c&#x27;</span> to cancel): 1</span><br><span class="line">Obtaining a new certificate</span><br><span class="line">Performing the following challenges:</span><br><span class="line">http-01 challenge <span class="keyword">for</span> chengfeng.site</span><br><span class="line">Waiting <span class="keyword">for</span> verification...</span><br><span class="line">Cleaning up challenges</span><br><span class="line">Deploying Certificate to VirtualHost /etc/nginx/sites-enabled/chengfeng.site</span><br><span class="line"></span><br><span class="line">Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">1: No redirect - Make no further changes to the webserver configuration.</span><br><span class="line">2: Redirect - Make all requests redirect to secure HTTPS access. Choose this <span class="keyword">for</span></span><br><span class="line">new sites, or <span class="keyword">if</span> you<span class="string">&#x27;re confident your site works on HTTPS. You can undo this</span></span><br><span class="line"><span class="string">change by editing your web server&#x27;</span>s configuration.</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">Select the appropriate number [1-2] <span class="keyword">then</span> [enter] (press <span class="string">&#x27;c&#x27;</span> to cancel): 2</span><br><span class="line">Redirecting all traffic on port 80 to ssl <span class="keyword">in</span> /etc/nginx/sites-enabled/chengfeng.site</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">Congratulations! You have successfully enabled https://chengfeng.site</span><br><span class="line"></span><br><span class="line">You should <span class="built_in">test</span> your configuration at:</span><br><span class="line">https://www.ssllabs.com/ssltest/analyze.html?d=chengfeng.site</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">IMPORTANT NOTES:</span><br><span class="line"> - Congratulations! Your certificate and chain have been saved at:</span><br><span class="line">   /etc/letsencrypt/live/chengfeng.site/fullchain.pem</span><br><span class="line">   Your key file has been saved at:</span><br><span class="line">   /etc/letsencrypt/live/chengfeng.site/privkey.pem</span><br><span class="line">   Your cert will expire on 2018-09-08. To obtain a new or tweaked</span><br><span class="line">   version of this certificate <span class="keyword">in</span> the future, simply run certbot again</span><br><span class="line">   with the <span class="string">&quot;certonly&quot;</span> option. To non-interactively renew *all* of</span><br><span class="line">   your certificates, run <span class="string">&quot;certbot renew&quot;</span></span><br><span class="line"> - If you like Certbot, please consider supporting our work by:</span><br><span class="line"></span><br><span class="line">   Donating to ISRG / Let<span class="string">&#x27;s Encrypt:   https://letsencrypt.org/donate</span></span><br><span class="line"><span class="string">   Donating to EFF:                    https://eff.org/donate-le</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p>配置成功后，证书有三个月的有效期，三个月后可以通过</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot --nginx certonly</span><br></pre></td></tr></table></figure>

<p>刷新证书，也可以通过非交互的方式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo certbot renew</span><br></pre></td></tr></table></figure>

<p>刷新所有证书。 我们可以设置定时任务刷新证书，也可以开启certbot的邮件提醒功能避免站点异常。 <strong>注意：</strong> 使用https配置完证书后要注意站点中资源是否都是通过https域名获取的，如果有些资源还是http的话记得也改成https，否则在chrome等浏览器中不会出现绿色的安全提示。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://zhuochengwo.github.io/blog/2018/06/02/%E8%A7%A3%E5%86%B3%E6%96%B0%E5%AE%89%E8%A3%85%E7%9A%84msyql%E9%9C%80%E8%A6%81sudo%E8%BF%9E%E6%8E%A5%E7%9A%84%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Chengfeng">
      <meta itemprop="description" content="生活的点点滴滴">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程枫的个人博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2018/06/02/%E8%A7%A3%E5%86%B3%E6%96%B0%E5%AE%89%E8%A3%85%E7%9A%84msyql%E9%9C%80%E8%A6%81sudo%E8%BF%9E%E6%8E%A5%E7%9A%84%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">解决msyql需要sudo连接的问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-06-02 15:04:53" itemprop="dateCreated datePublished" datetime="2018-06-02T15:04:53+08:00">2018-06-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-15 13:45:28" itemprop="dateModified" datetime="2020-12-15T13:45:28+08:00">2020-12-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B2%E4%BB%A3%E7%A0%81/" itemprop="url" rel="index"><span itemprop="name">敲代码</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在ubuntu上使用安装完mysql后，但是首次无密码连接却被拒，只能sudo连接。 在Stack Overflow上找到了相关说明，原因是mysql使用了auth_socket plugin进行认证。</p>
<blockquote>
<p>If you install 5.7 and don’t provide a password to the root user, it will use the auth_socket plugin. That plugin doesn’t care and doesn’t need a password. It just checks if the user is connecting using a UNIX socket and then compares the username.</p>
</blockquote>
<p>解决方法是使用msyql自带密码认证功能</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">WITH</span> mysql_native_password <span class="keyword">BY</span> <span class="string">&#x27;password&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>退出后就可以使用上边命令设置的密码登录了，不再需要sudo。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://zhuochengwo.github.io/blog/2018/06/02/%E8%A7%A3%E5%86%B3git-clone-the-remote-end-hung-up-unexpectedly-fatal-early-eof%E7%9A%84%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Chengfeng">
      <meta itemprop="description" content="生活的点点滴滴">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程枫的个人博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2018/06/02/%E8%A7%A3%E5%86%B3git-clone-the-remote-end-hung-up-unexpectedly-fatal-early-eof%E7%9A%84%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">解决Git clone时The remote end hung up unexpectedly fatal: early EOF的问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-06-02 14:51:03" itemprop="dateCreated datePublished" datetime="2018-06-02T14:51:03+08:00">2018-06-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-15 13:45:28" itemprop="dateModified" datetime="2020-12-15T13:45:28+08:00">2020-12-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B2%E4%BB%A3%E7%A0%81/" itemprop="url" rel="index"><span itemprop="name">敲代码</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/Git/" itemprop="url" rel="index"><span itemprop="name">Git</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在git clone项目的时候碰到这样一个错误：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@gitee.com:chengfengGit/blog.git</span><br><span class="line">Cloning into <span class="string">&#x27;blog&#x27;</span>...</span><br><span class="line">The authenticity of host <span class="string">&#x27;gitee.com (120.55.226.24)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:FQGC9Kn/eye1W8icdBgrQp+KkGYoFgbVr17bmjey0Wc.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span>gitee.com,120.55.226.24<span class="string">&#x27; (ECDSA) to the list of known hosts.</span></span><br><span class="line"><span class="string">remote: Counting objects: 4389, done.</span></span><br><span class="line"><span class="string">remote: Compressing objects: 100% (3238/3238), done.</span></span><br><span class="line"><span class="string">packet_write_wait: Connection to 120.55.226.24 port 22: Broken pipe</span></span><br><span class="line"><span class="string">fatal: The remote end hung up unexpectedly</span></span><br><span class="line"><span class="string">fatal: early EOF</span></span><br><span class="line"><span class="string">fatal: index-pack failed</span></span><br></pre></td></tr></table></figure>

<p>网上找了下，解决方法如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global core.compression 0</span><br></pre></td></tr></table></figure>

<p>退出重新登录就好了。 碰到了两次，记录下，免得每次都去找</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://zhuochengwo.github.io/blog/2018/06/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%B8%A9%E5%9D%91%E7%BB%8F%E5%8E%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Chengfeng">
      <meta itemprop="description" content="生活的点点滴滴">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程枫的个人博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2018/06/02/%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%B8%A9%E5%9D%91%E7%BB%8F%E5%8E%86/" class="post-title-link" itemprop="url">记一次踩坑经历</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-06-02 14:46:28" itemprop="dateCreated datePublished" datetime="2018-06-02T14:46:28+08:00">2018-06-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-15 13:45:28" itemprop="dateModified" datetime="2020-12-15T13:45:28+08:00">2020-12-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E8%9B%87%E7%B2%BE%E7%97%85/" itemprop="url" rel="index"><span itemprop="name">蛇精病</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>是这样的，我在写完博客发布却发现博客变成了定时发布，搜了下是说wordpress时区设置问题，在后台看了下wordpress时区设置是没有问题的，把php的时区设置成了Asia/shanghai也是没有问题，直接使用php date函数输出当前时间也是对的。懵逼了哈！找了大半天，google翻了好几页，还是没解决。 但这时我发现了一个细节，在wordpress后台设置那里，UTC时间显示的是本地时间，而本地时间显示的则是在实际本地时间的基础上+8小时，这什么鬼啊？没办法，只能上手看wordpress源码调试了。 在本地直接调试发现wp-include/functions.php里边date_i18n函数输出的是没有问题的，到了服务器上这里输出的却不对了。在wp-seting.php文件中，发现date_default_timezone_set( ‘UTC’ )，wordpress默认使用UTC时区，调试发现设置UTC但是date()函数输出的还是北京时间，这就奇怪了。 写个测试代码继续试：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    var_dump(date_default_timezone_get());</span><br><span class="line">    var_dump(date(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>));</span><br><span class="line">    <span class="variable">$res</span> = date_default_timezone_set( <span class="string">&#x27;UTC&#x27;</span> );</span><br><span class="line">    var_dump(<span class="variable">$res</span>);</span><br><span class="line">    var_dump(date_default_timezone_get());</span><br><span class="line">    var_dump(date(<span class="string">&#x27;Y-m-d H:i:s&#x27;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>却得到了这样的结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">php test.php      </span><br><span class="line">string(14) <span class="string">&quot;Asia/Chongqing&quot;</span></span><br><span class="line">string(19) <span class="string">&quot;2018-06-02 00:33:05&quot;</span></span><br><span class="line">bool(<span class="literal">true</span>)</span><br><span class="line">string(3) <span class="string">&quot;UTC&quot;</span></span><br><span class="line">string(19) <span class="string">&quot;2018-06-02 00:33:05&quot;</span></span><br></pre></td></tr></table></figure>

<p>很神奇啊有木马，继续搜啊搜，还是啥结果没有，彻底懵了。<code>date_default_timezone_set( &#39;UTC&#39; )</code>;还能不生效？ 搞到晚上1点多还是没想明白，系统时区，php时区各种尝试了个遍，反正就是没效果，没解，只能等明天找人问问试试。 睡了一觉起来，继续去看这个问题，还是没什么头绪，把问题丢到swoole群里，不出意外的没人鸟你。问题不能不解决啊，只能继续摸索，甚至怀疑发现了php的bug，但是本地的版本跟服务器是一样的，却没有这个问题，那只能是系统的问题。 继续在ubuntu上找问题，这时发现了一个奇怪的现象，我设置系统UTC时区的时候，date输出的还是本地时间，而且跟我设置成“Asia/shanghai”时输出的是一样内容，跟wordpress上UTC打印出来的确是本地时间一个现象了，至此可以肯定是系统哪里设置有问题。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">timedatectl</span><br><span class="line">                      Local time: Sat 2018-06-02 14:31:11 CST</span><br><span class="line">                  Universal time: Sat 2018-06-02 06:31:11 UTC</span><br><span class="line">                        RTC time: Sat 2018-06-02 06:31:12</span><br><span class="line">                       Time zone: UTC (CST, +0800)</span><br><span class="line">       System clock synchronized: yes</span><br><span class="line">systemd-timesyncd.service active: yes</span><br><span class="line">                 RTC <span class="keyword">in</span> <span class="built_in">local</span> TZ: no&lt;</span><br></pre></td></tr></table></figure>

<p>使用timedatectl发现Time zone： UTC （CST，+0800）这是什么鬼？这不符合常理啊，UTC不应该是+0吗，这个时候我想起来之前设置系统时区的时候看别人博客有个复制操作，当时没怎么注意，使用history找到了那行命令:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /etc/timezone /usr/share/zoneinfo/UTC</span><br></pre></td></tr></table></figure>

<p>发现问题有木有，我在将时区设置成Asia/Shanghai后把timezone内容拷贝覆盖了UTC时区的内容，这样就导致我设置UTC时区输出的都是Asia/Shanghai的，坑了，这就是看别人博客复制命令不看就执行的下场，浪费了这么多时间。 那只要恢复UTC文件的内容即可。但由于我耗费了不少时间，脑子不灵光了，准备先删除/usr/share/zoneinfo/UTC再拷贝一个进去的时候，手抖了还是怎么着了，我也不知道，我只知道我按下回车键后看到的是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -rf /etc</span><br></pre></td></tr></table></figure>

<p>仅次于<code>rm -rf /</code>的神一样的命令，当场又懵了。 好在数据库的内容没有丢，靠着这个ssh连接把数据库给备份出来了。 一切又重新开始了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://zhuochengwo.github.io/blog/2018/06/01/ubuntu%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2logrotate/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Chengfeng">
      <meta itemprop="description" content="生活的点点滴滴">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程枫的个人博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2018/06/01/ubuntu%E6%97%A5%E5%BF%97%E5%88%86%E5%89%B2logrotate/" class="post-title-link" itemprop="url">Ubuntu日志分割logrotate</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-06-01 21:38:31" itemprop="dateCreated datePublished" datetime="2018-06-01T21:38:31+08:00">2018-06-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-15 14:45:39" itemprop="dateModified" datetime="2020-12-15T14:45:39+08:00">2020-12-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B2%E4%BB%A3%E7%A0%81/" itemprop="url" rel="index"><span itemprop="name">敲代码</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/Ubuntu/" itemprop="url" rel="index"><span itemprop="name">Ubuntu</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>对于日志管理，特别是日志文件比较大的时候我们一般都需要转储整理，这里介绍一个非常强大的工具logrotate，我们可以利用它来对日志文件进行统一归档管理。可以根据日志文件的大小，也可以根据其天数来转储。 ubuntu默认已经安装logrotate，logrotate的配置文件是/etc/logrotate.conf，通常不需要对它进行修改。日志文件的轮循设置在独立的配置文件中，它们放在/etc/logrotate.d/目录下。 logrotate常用参数如下：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">daily                     #指定转储周期为每天</span><br><span class="line">weekly                    #指定转储周期为每周；</span><br><span class="line">monthly                   #指定转储周期为每月；</span><br><span class="line">rotate <span class="built_in">count</span>              #指定日志文件删除之前转储的次数，<span class="number">0</span>指没有备份，<span class="number">5</span>指保留<span class="number">5</span>个备份；</span><br><span class="line">compress                  #通过gzip压缩转储以后的日志；</span><br><span class="line">nocompress                #不需要压缩时，用这个参数；</span><br><span class="line">delaycompress             #延迟压缩，和compress一起使用时，转储的日志文件到下一次转储时才压缩；</span><br><span class="line">nodelaycompress           #覆盖delaycompress选项，转储同时压缩；</span><br><span class="line">copytruncate              #用于还在打开中的日志文件，把当前日志备份并截断；</span><br><span class="line">nocopytruncate            #备份日志文件但是不截断；</span><br><span class="line">create <span class="keyword">mode</span> owner group   #转储文件，使用指定的文件模式创建新的日志文件；</span><br><span class="line">nocreate                  #不建立新的日志文件；</span><br><span class="line">errors address            #专储时的错误信息发送到指定的Email地址；</span><br><span class="line">ifempty                   #即使是空文件也转储，这个是logrotate的缺省选项；</span><br><span class="line">notifempty                #如果是空文件的话，不转储；</span><br><span class="line">mail address              #把转储的日志文件发送到指定的E-mail地；</span><br><span class="line">nomail                    #转储时不发送日志文件；</span><br><span class="line">olddir directory          #转储后的日志文件放入指定的目录，必须和当前日志文件在同一个文件系统；</span><br><span class="line">noolddir                  #转储后的日志文件和当前日志文件放在同一个目录下；</span><br><span class="line">prerotate/endscript       #在转储以前需要执行的命令可以放入这个对，这两个关键字必须单独成行；</span><br><span class="line">postrotate/endscript      #在转储以后需要执行的命令可以放入这个对，这两个关键字必须单独成行；</span><br><span class="line">tabootext [+] <span class="keyword">list</span>        #让logrotate不转储指定扩展名的文件，缺省的扩展名是：.rpm-orig, .rpmsave,v,和~ ；</span><br><span class="line">size size                 #当日志文件到达指定的大小时才转储，Size可以指定bytes(缺省)以及KB(sizek)或者MB(sizem)；</span><br><span class="line">postrotate <span class="symbol">&lt;s&gt;</span> endscript  #日志轮换过后指定指定的脚本，endscript参数表示结束脚本；</span><br><span class="line">sharedscripts             #共享脚本,下面的postrotate <span class="symbol">&lt;s&gt;</span> endscript中的脚本只执行一次即可</span><br></pre></td></tr></table></figure>

<p>nginx在安装后默认已经启用了logrotate，这里我们参照着nginx的配置对我们shadowsocks的日子做一个归档管理</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/logrotate.d/nginx </span><br></pre></td></tr></table></figure>

<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/var/<span class="built_in">log</span>/nginx/*.<span class="built_in">log</span> &#123;</span><br><span class="line">    daily</span><br><span class="line">    missingok</span><br><span class="line">    rotate <span class="number">14</span></span><br><span class="line">    compress</span><br><span class="line">    delaycompress</span><br><span class="line">    notifempty</span><br><span class="line">    create <span class="number">0640</span> www-data adm</span><br><span class="line">    sharedscripts</span><br><span class="line">    prerotate</span><br><span class="line">        if [ -d /etc/logrotate.d/httpd-prerotate ]; then \</span><br><span class="line">            run-parts /etc/logrotate.d/httpd-prerotate; \</span><br><span class="line">        fi \</span><br><span class="line">    endscript</span><br><span class="line">    postrotate</span><br><span class="line">        invoke-rc.d nginx rotate &gt;/dev/null <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /etc/logrotate.d/nginx /etc/logrotate.d/shadowsocks</span><br></pre></td></tr></table></figure>

<p>为了方便查看，这里不进行压缩，并且去掉了一些脚本操作，加入了dateext以日期作为文件后缀，同时保留30天的日子</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/var/<span class="built_in">log</span>/shadowsocks/*.<span class="built_in">log</span> &#123;</span><br><span class="line">    daily</span><br><span class="line">    missingok</span><br><span class="line">    rotate <span class="number">30</span></span><br><span class="line">    nocompress</span><br><span class="line">    dateext</span><br><span class="line">    notifempty</span><br><span class="line">    create <span class="number">0640</span> chengfeng chengfeng</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改完毕后使用下边的命令测试配置是否正确</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo logrotate -f /etc/logrotate.d/shadowsocks</span><br></pre></td></tr></table></figure>

<p>执行后可以看到已经进行了归档。 logrotate需要的<strong>cron</strong>任务应该在安装时就自动创建了，我们不需要做额外的操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/cron.daily/logrotate </span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Clean non existent log file entries from status file</span></span><br><span class="line"><span class="built_in">cd</span> /var/lib/logrotate</span><br><span class="line"><span class="built_in">test</span> -e status  touch status</span><br><span class="line">head -1 status &gt; status.clean</span><br><span class="line">sed <span class="string">&#x27;s/&quot;//g&#x27;</span> status  <span class="keyword">while</span> <span class="built_in">read</span> logfile date</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    [ -e <span class="string">&quot;<span class="variable">$logfile</span>&quot;</span> ] &amp;&amp; <span class="built_in">echo</span> <span class="string">&quot;\&quot;<span class="variable">$logfile</span>\&quot; <span class="variable">$date</span>&quot;</span></span><br><span class="line"><span class="keyword">done</span> &gt;&gt; status.clean</span><br><span class="line">mv status.clean status</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span> -x /usr/sbin/logrotate  <span class="built_in">exit</span> 0</span><br><span class="line">/usr/sbin/logrotate /etc/logrotate.conf</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://zhuochengwo.github.io/blog/2018/05/25/ubuntu%E6%90%AD%E5%BB%BAshadowsocks%E6%9C%8D%E5%8A%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Chengfeng">
      <meta itemprop="description" content="生活的点点滴滴">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程枫的个人博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2018/05/25/ubuntu%E6%90%AD%E5%BB%BAshadowsocks%E6%9C%8D%E5%8A%A1/" class="post-title-link" itemprop="url">Ubuntu搭建shadowsocks服务</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-05-25 11:15:58" itemprop="dateCreated datePublished" datetime="2018-05-25T11:15:58+08:00">2018-05-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-15 13:45:28" itemprop="dateModified" datetime="2020-12-15T13:45:28+08:00">2020-12-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/Ubuntu/" itemprop="url" rel="index"><span itemprop="name">Ubuntu</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>试用的 <code>aws</code> 到期了，这两天准备迁移到 <code>gcp</code> 了，不得不说，<code>gcp</code> 用起来还是比 <code>aws</code> 舒服多了，选了<code>ubuntu 18.04</code> 的台湾机房服务器，当然第一件事就是 <code>shadowsocks</code> 了。 搭建很简单，几条命名搞定：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果还没有安装python的话先安装python，Ubuntu默认已经安装了</span></span><br><span class="line">sudo apt-get install python</span><br><span class="line"></span><br><span class="line">sudo apt-get install python-pip</span><br><span class="line"></span><br><span class="line">sudo pip install shadowsocks</span><br></pre></td></tr></table></figure>

<p>编辑一个<code>ss</code>账号的配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/shadowsocks.json</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;server&quot;</span>:<span class="string">&quot;server_ip&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;server_port&quot;</span>:<span class="number">8388</span>,</span><br><span class="line">    <span class="attr">&quot;local_address&quot;</span>:<span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;local_port&quot;</span>:<span class="number">1080</span>,</span><br><span class="line">    <span class="attr">&quot;password&quot;</span>:<span class="string">&quot;mypassword&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;timeout&quot;</span>:<span class="number">300</span>,</span><br><span class="line">    <span class="attr">&quot;method&quot;</span>:<span class="string">&quot;aes-256-cfb&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述配置中的<code>server_ip</code>可以填入<code>0.0.0.0</code> 或是服务器内网ip 如果需要配置多个账号的话可以这样：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;server&quot;</span>:<span class="string">&quot;server_ip&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;port_password&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;9001&quot;</span>:<span class="string">&quot;pwd001&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;9002&quot;</span>:<span class="string">&quot;pwd002&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;9003&quot;</span>:<span class="string">&quot;pwd003&quot;</span></span><br><span class="line">     &#125;,</span><br><span class="line">    <span class="attr">&quot;local_address&quot;</span>:<span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;local_port&quot;</span>:<span class="number">1080</span>,</span><br><span class="line">    <span class="attr">&quot;timeout&quot;</span>:<span class="number">300</span>,</span><br><span class="line">    <span class="attr">&quot;method&quot;</span>:<span class="string">&quot;aes-256-cfb&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动服务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ssserver -c /etc/shadowsocks.json -d start</span><br></pre></td></tr></table></figure>

<p>本来一切到这里就结束了，但在<code>18.04上</code>报了个错，原因是<code>openssl</code>版本的问题。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ssserver -c /etc/shadowsocks.json -d start</span><br><span class="line">INFO: loading config from /etc/shadowsocks.json</span><br><span class="line">2018-05-25 02:32:18 INFO     loading libcrypto from libcrypto.so.1.1</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;/usr/local/bin/ssserver&quot;</span>, line 11, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    load_entry_point(<span class="string">&#x27;shadowsocks==2.8.2&#x27;</span>, <span class="string">&#x27;console_scripts&#x27;</span>, <span class="string">&#x27;ssserver&#x27;</span>)()</span><br><span class="line">  File <span class="string">&quot;/usr/local/lib/python2.7/dist-packages/shadowsocks/server.py&quot;</span>, line 34, <span class="keyword">in</span> main</span><br><span class="line">    config = shell.get_config(False)</span><br><span class="line">  File <span class="string">&quot;/usr/local/lib/python2.7/dist-packages/shadowsocks/shell.py&quot;</span>, line 262, <span class="keyword">in</span> get_config</span><br><span class="line">    check_config(config, is_local)</span><br><span class="line">  File <span class="string">&quot;/usr/local/lib/python2.7/dist-packages/shadowsocks/shell.py&quot;</span>, line 124, <span class="keyword">in</span> check_config</span><br><span class="line">    encrypt.try_cipher(config[<span class="string">&#x27;password&#x27;</span>], config[<span class="string">&#x27;method&#x27;</span>])</span><br><span class="line">  File <span class="string">&quot;/usr/local/lib/python2.7/dist-packages/shadowsocks/encrypt.py&quot;</span>, line 44, <span class="keyword">in</span> try_cipher</span><br><span class="line">    Encryptor(key, method)</span><br><span class="line">  File <span class="string">&quot;/usr/local/lib/python2.7/dist-packages/shadowsocks/encrypt.py&quot;</span>, line 83, <span class="keyword">in</span> __init__</span><br><span class="line">    random_string(self._method_info[1]))</span><br><span class="line">  File <span class="string">&quot;/usr/local/lib/python2.7/dist-packages/shadowsocks/encrypt.py&quot;</span>, line 109, <span class="keyword">in</span> get_cipher</span><br><span class="line">    <span class="built_in">return</span> m[2](method, key, iv, op)</span><br><span class="line">  File <span class="string">&quot;/usr/local/lib/python2.7/dist-packages/shadowsocks/crypto/openssl.py&quot;</span>, line 76, <span class="keyword">in</span> __init__</span><br><span class="line">    load_openssl()</span><br><span class="line">  File <span class="string">&quot;/usr/local/lib/python2.7/dist-packages/shadowsocks/crypto/openssl.py&quot;</span>, line 52, <span class="keyword">in</span> load_openssl</span><br><span class="line">    libcrypto.EVP_CIPHER_CTX_cleanup.argtypes = (c_void_p,)</span><br><span class="line">  File <span class="string">&quot;/usr/lib/python2.7/ctypes/__init__.py&quot;</span>, line 379, <span class="keyword">in</span> __getattr__</span><br><span class="line">    func = self.__getitem__(name)</span><br><span class="line">  File <span class="string">&quot;/usr/lib/python2.7/ctypes/__init__.py&quot;</span>, line 384, <span class="keyword">in</span> __getitem__</span><br><span class="line">    func = self._FuncPtr((name_or_ordinal, self))</span><br><span class="line">AttributeError: /usr/lib/x86_64-linux-gnu/libcrypto.so.1.1: undefined symbol: EVP_CIPHER_CTX_cleanup</span><br></pre></td></tr></table></figure>

<p>官方其实已经解决了这个问题，但是我们通过pip安装的shadowsocks并不是最新版，更新一下就好</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip install -U git+https://github.com/shadowsocks/shadowsocks.git@master</span><br></pre></td></tr></table></figure>

<p>之前装的是<code>2.8.2</code>的版本，更新后现在是<code>3.0.0</code>的。再启动就正常了 设置一下防火墙，下边是我的设置，我开的是<code>1194</code>端口，根据自己的端口修改即可 <img src="https://blog-1252719385.cos.ap-guangzhou.myqcloud.com/images/20180525133441.png"> <code>shadowsocks</code>的日志在</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/<span class="built_in">log</span>/shadowsocks.log</span><br></pre></td></tr></table></figure>

<p>可以看到被代理的相关信息。 剩下的就是在自己的客户端配置上新的ss咯！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="https://zhuochengwo.github.io/blog/2018/05/13/php%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="Chengfeng">
      <meta itemprop="description" content="生活的点点滴滴">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程枫的个人博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2018/05/13/php%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F/" class="post-title-link" itemprop="url">PHP静态变量</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-05-13 14:22:40" itemprop="dateCreated datePublished" datetime="2018-05-13T14:22:40+08:00">2018-05-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-15 13:45:28" itemprop="dateModified" datetime="2020-12-15T13:45:28+08:00">2020-12-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B2%E4%BB%A3%E7%A0%81/" itemprop="url" rel="index"><span itemprop="name">敲代码</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/PHP/" itemprop="url" rel="index"><span itemprop="name">PHP</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>PHP一般用作web开发，处理http请求，例如nginx + php-fm。FPM 是一个 PHP 进程管理器，包含 master 进程和 worker 进程两种进程：master 进程只有一个，负责监听端口，接收来自 Web Server (nginx)的请求，而 worker 进程则一般有多个 (具体数量根据实际需要配置)，每个进程内部都嵌入了一个 PHP 解释器，是 PHP 代码真正执行的地方。不同的请求是在不同的php-fpm进程中解析执行的，每个进程(系统进行资源分配和调度的基本单位)是独享内存的互不干扰。php-fpm每次都会初始化，静态变量即在此刻写入内存，这种情况下，虽然程序代码中使用的是static，但是这个static只对单个请求生效，请求之间是互相隔离不会造成干扰的。 但随着swoole出现，php的编程方式也带来了一些变化，其中之一就是有了通俗意义上的static。 我们来试着测试下基于swoole的http server</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//全局变量</span></span><br><span class="line"><span class="variable">$show</span> = <span class="string">&#x27;hello world&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$hello</span> = <span class="string">&#x27;hello test&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$http</span> = <span class="keyword">new</span> swoole_http_server(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9501</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$http</span>-&gt;on(<span class="string">&quot;start&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$server</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Swoole http server is started at http://127.0.0.1:9501\n&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable">$http</span>-&gt;on(<span class="string">&quot;request&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$request</span>, <span class="variable">$response</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$response</span>-&gt;header(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/plain&quot;</span>);</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$show</span>;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$request</span>-&gt;get)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$request</span>-&gt;get[<span class="string">&#x27;global&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;设置全局变量值为<span class="subst">&#123;$request-&gt;get[&#x27;global&#x27;]&#125;</span>\n&quot;</span>;</span><br><span class="line">            <span class="variable">$show</span> = <span class="variable">$request</span>-&gt;get[<span class="string">&#x27;global&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$request</span>-&gt;get[<span class="string">&#x27;static&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;设置类静态变量值为<span class="subst">&#123;$request-&gt;get[&#x27;static&#x27;]&#125;</span>\n&quot;</span>;</span><br><span class="line">            Test::<span class="variable">$hello</span> = <span class="variable">$request</span>-&gt;get[<span class="string">&#x27;static&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$info</span> = <span class="string">&quot;类静态变量:&quot;</span> . Test::<span class="variable">$hello</span> . <span class="string">&quot; #### &quot;</span> . <span class="string">&quot;全局变量:<span class="subst">$show</span>\n\n\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$info</span>;</span><br><span class="line">    <span class="variable">$response</span>-&gt;end(<span class="variable">$info</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable">$http</span>-&gt;start();</span><br></pre></td></tr></table></figure>

<p>这段代码测试全局变量和类静态变量是否在每次请求中会被保留下来。 使用php server.php直接启动http server，方便在控制台查看输出的内容，使用curl传入不同的get参数来进行测试。 curl调用输出内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&quot;127.0.0.1:9501&quot;</span></span><br><span class="line">类静态变量:hello <span class="built_in">test</span> <span class="comment">#### 全局变量:hello world</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">curl <span class="string">&quot;127.0.0.1:9501?global=aaaaaa&amp;static=11111&quot;</span> </span><br><span class="line">类静态变量:11111 <span class="comment">#### 全局变量:aaaaaa</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">curl <span class="string">&quot;127.0.0.1:9501&quot;</span>                           </span><br><span class="line">类静态变量:11111 <span class="comment">#### 全局变量:aaaaaa</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>server输入内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span> php server.php </span><br><span class="line">Swoole http server is started at http://127.0.0.1:9501</span><br><span class="line"></span><br><span class="line">类静态变量:hello <span class="built_in">test</span> <span class="comment">#### 全局变量:hello world</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">设置全局变量值为aaaaaa</span><br><span class="line">设置类静态变量值为11111</span><br><span class="line">类静态变量:11111 <span class="comment">#### 全局变量:aaaaaa</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">类静态变量:11111 <span class="comment">#### 全局变量:aaaaaa</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>第一次请求，没有get参数，输出全局变量$show和test类静态变量$hello的默认值。 第二次请求，传入get参数，设置全局变量$show为aaaaaa，设置test类静态变量$hello的值为11111，可以看到打印出的内容发生了变化，说明变量被修改了。 第三次请求，没有get参数，输出结果同第二次请求相同，说明全局变量和类静态变量的值不会在请求结束后释放，能一直保存在内容中。 通过这个简单的例子可以看到，swoole这种常住内存的方式是能提供通俗意义上静态变量的实现，不同于php-fpm的处理方式的。在编程中使用swoole是需要特别注意这些区别，避免在使用静态变量是发生出乎意料的bug。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/blog/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/blog/">1</a><a class="page-number" href="/blog/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/blog/page/4/">4</a><a class="page-number" href="/blog/page/5/">5</a><a class="extend next" rel="next" href="/blog/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Chengfeng</p>
  <div class="site-description" itemprop="description">生活的点点滴滴</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">43</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chengfeng</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/muse.js"></script>


<script src="/blog/js/next-boot.js"></script>




  















  

  

</body>
</html>
